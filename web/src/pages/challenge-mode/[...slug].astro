---
import ModernChallengeModeLayout from "../../layouts/ModernChallengeModeLayout.astro";
import { dungeonSlugToId } from "../../lib/wow-constants";

// Enable server-side rendering for this dynamic route (SPA behavior)
export const prerender = false;

// Parse the slug dynamically for client-side routing (SPA mode)
const slug = Astro.params.slug || "";
const slugParts = slug.split("/");

let initialLeaderboardType = "dungeon";
let initialRegion = "global";
let initialRealm = "";
let initialDungeon = "2"; // Default dungeon

// Parse different URL patterns
if (slugParts.length === 1) {
  // /challenge-mode/players or /challenge-mode/teams
  if (slugParts[0] === "players" || slugParts[0] === "teams") {
    initialLeaderboardType = slugParts[0];
  }
} else if (slugParts.length === 2) {
  // /challenge-mode/global/dungeon-slug
  if (slugParts[0] === "global") {
    initialRegion = "global";
    initialRealm = "";
    initialDungeon = dungeonSlugToId(slugParts[1]) || "2";
  }
} else if (slugParts.length === 3) {
  // /challenge-mode/region/realm/dungeon-slug or /challenge-mode/region/all/dungeon-slug
  initialRegion = slugParts[0];
  initialRealm = slugParts[1];
  initialDungeon = dungeonSlugToId(slugParts[2]) || "2";
}
---

<ModernChallengeModeLayout
  initialLeaderboardType={initialLeaderboardType}
  initialRegion={initialRegion}
  initialRealm={initialRealm}
  initialDungeon={initialDungeon}
/>
